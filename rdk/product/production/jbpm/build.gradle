
subprojects {
	apply plugin: 'java' 

  ext.set('groupId', 'us.vistacore.jbpm')
  ext.set('commitCountDir', projectDir)

  ext.set('javaVersion', '1.8')
  ext.set('targetJavaVersion', '1.8')
  ext.set('kie-version', '6.4.0.Final')
  ext.set('jboss-logging', '3.3.0.Final')
  ext.set('servlet-api', '3.1.0')
  ext.set('commons-lang3', '3.4')
  ext.set('spring-version', '4.2.4.RELEASE')
  ext.set('gson-version', '2.6.2')
  ext.set('json-version', '20160810')
  ext.set('joda-version', '1.6.2.redhat-5')
  ext.set('junit-version', '3.8.1')
  ext.set('hibernate-jpa-version', '1.0.1.Final')
  ext.set('hibernate-core-version', '4.2.18.Final')

  def repoCommitCountClosure = {
    def proc = ['sh', '-c', "git rev-list --count --first-parent HEAD ${->commitCountDir}"].execute()
    return proc.text.trim()
  }

  def repoCommitCount = "${->repoCommitCountClosure()}"
  def version = "${->repoVersion + '.' + repoCommitCount}"

  repositories {
    maven {
      url 'http://nexus.osehra.org:8081/nexus/content/groups/public'
    }
  }
  
  uploadArchives {
    repositories.mavenDeployer {
      pom.groupId = "${->groupId}"
      pom.version = "${->version}"
      repository(url: "${->nexusURL}/nexus/content/repositories/${->uploadRepo}/") {
        authentication(userName: System.getenv()['NEXUS_USER_NAME'], password: System.getenv()['NEXUS_PASSWORD'])
      }
    }
  }
}
