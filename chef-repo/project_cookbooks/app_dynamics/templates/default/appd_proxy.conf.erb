description "app dynamics monitoring process"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 5 30

env PATH=/opt/chef/bin:/opt/chef/embedded/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

exec sh -c 'proxy_exe="$(for exe in /opt/*/node_modules/appdynamics-proxy/proxy/runProxy; do [ -x "$exe" ] && echo "$exe" && break; done)"; [ -z "$proxy_exe" ] && echo missing appdynamics node modules && exit 1; sudo "$proxy_exe" -j "$(dirname $proxy_exe)"/../../appdynamics-jre/jre -- <%= node[:app_dynamics][:proxy][:ctl_dir] %> <%= node[:app_dynamics][:proxy][:log_path] %>'
