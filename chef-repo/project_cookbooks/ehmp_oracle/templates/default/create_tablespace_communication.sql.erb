DECLARE
    u_count number;
    tblspace_name VARCHAR2 (50);
    tblspace_file VARCHAR2 (50);
    tblspace_size VARCHAR2 (50);
    tblspace_extent VARCHAR2 (50);
BEGIN

<% @tablespaces.each do |name, properties| %>
    u_count := 0;
    tblspace_name := '<%= name %>';
    tblspace_file := '<%= properties['file'] %>';
    tblspace_size := '<%= properties['size'] %>';
    tblspace_extent := '<%= properties['extent'] %>';

    SELECT COUNT (1) INTO u_count FROM dba_tablespaces WHERE tablespace_name = tblspace_name;

    IF u_count = 0  THEN
       EXECUTE IMMEDIATE 'CREATE TABLESPACE '||tblspace_name||' datafile '''||tblspace_file||''' SIZE '||tblspace_size||' REUSE '||
                         'AUTOEXTEND ON NEXT '||tblspace_extent||' MAXSIZE UNLIMITED EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
    END IF;
<% end %>

    EXCEPTION
       WHEN OTHERS
          THEN
                 DBMS_OUTPUT.put_line (SQLERRM);
                 DBMS_OUTPUT.put_line ('   ');
                 RAISE;
END;
/
